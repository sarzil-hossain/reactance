- name: "create certificate dir"
  ansible.builtin.file:
    path: /var/vpns/ocserv/certs/
    state: directory
    owner: _vpn
    group: _vpn

- name: "generate server certs and key"
  ansible.builtin.shell: "openssl req -x509 -newkey rsa:4096 -keyout /var/vpns/hysteria/certs/server-key.pem -out /var/vpns/hysteria/certs/server-cert.pem -sha256 -days 3650 -nodes -subj '/CN=JohnDane'"

- name: "template out ocserv config"
  ansible.builtin.template:
    src: ocserv.conf.j2
    dest: /var/vpns/ocserv/ocserv.conf
  notify:
    - hysteria_start
