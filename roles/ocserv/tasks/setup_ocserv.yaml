- name: "create certificate dir"
  ansible.builtin.file:
    path: /var/vpns/ocserv/cert/
    state: directory
    owner: _vpn
    group: _vpn

#  - name: "template out ca cert template"
#    ansible.builtin.template:
#      src: ca.tmpl.j2
#      dest: /var/vpns/ocserv/cert/ca.tmpl
#      owner: _vpn
#      group: root
#
#  - name: "generate ca cert and key"
#    ansible.builtin.shell: ""
#
#  - name: "template out server cert template"
#    ansible.builtin.template:
#      src: server.tmpl.j2
#      dest: /var/vpns/ocserv/cert/server.tmpl
#      owner: _vpn
#      group: root

- name: "generate server cert and key"
  ansible.builtin.shell: "openssl req -x509 -newkey rsa:4096 -keyout /var/vpns/ocserv/certs/server-key.pem -out /var/vpns/ocserv/certs/server-cert.pem -sha256 -days 3650 -nodes -subj '/CN=JohnDane'"


- name: "template out ocserv config"
  ansible.builtin.template:
    src: ocserv.conf.j2
    dest: /var/vpns/ocserv/ocserv.conf
